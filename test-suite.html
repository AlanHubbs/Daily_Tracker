<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily_Tracker Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        
        .test-section h2 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .test-group {
            margin-bottom: 20px;
        }
        
        .test-group h3 {
            color: #718096;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            background: #f7f7f7;
            transition: all 0.3s ease;
        }
        
        .test-item:hover {
            background: #f0f0f0;
        }
        
        .test-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
        }
        
        .test-status.pending {
            background: #cbd5e0;
        }
        
        .test-status.running {
            background: #fbbf24;
            animation: pulse 1s infinite;
        }
        
        .test-status.passed {
            background: #10b981;
        }
        
        .test-status.failed {
            background: #ef4444;
        }
        
        .test-status.warning {
            background: #f59e0b;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .test-name {
            flex: 1;
            color: #4a5568;
        }
        
        .test-result {
            color: #718096;
            font-size: 14px;
        }
        
        .control-panel {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #6366f1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #4f46e5;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #d1d5db;
        }
        
        .summary {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4a5568;
        }
        
        .stat-label {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }
        
        .error-details {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 6px;
            padding: 10px;
            margin-top: 5px;
            font-size: 12px;
            color: #991b1b;
            font-family: monospace;
        }
        
        .iframe-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 300px;
            border: 2px solid #6366f1;
            border-radius: 8px;
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }
        
        .iframe-header {
            background: #6366f1;
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #app-frame {
            width: 100%;
            height: calc(100% - 40px);
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª Daily_Tracker Test Suite</h1>
        <p class="subtitle">Automated testing for core functionality</p>
        
        <div class="control-panel">
            <button class="btn btn-primary" onclick="runAllTests()">Run All Tests</button>
            <button class="btn btn-secondary" onclick="resetTests()">Reset</button>
            <button class="btn btn-secondary" onclick="toggleAppFrame()">Toggle App View</button>
            <button class="btn btn-secondary" onclick="clearAppData()">Clear App Data</button>
        </div>
        
        <!-- Core Functionality Tests -->
        <div class="test-section">
            <h2>Core Functionality</h2>
            
            <div class="test-group">
                <h3>Local Storage</h3>
                <div class="test-item" data-test="storage-available">
                    <div class="test-status pending">-</div>
                    <div class="test-name">LocalStorage is available</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="storage-persist">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Data persists after save</div>
                    <div class="test-result"></div>
                </div>
            </div>
            
            <div class="test-group">
                <h3>Task Management</h3>
                <div class="test-item" data-test="task-create">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Create new task</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="task-complete">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Mark task as complete</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="task-delete">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Delete task</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="task-priority">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Task priority levels (low/med/high)</div>
                    <div class="test-result"></div>
                </div>
            </div>
            
            <div class="test-group">
                <h3>XP & Gamification</h3>
                <div class="test-item" data-test="xp-calculation">
                    <div class="test-status pending">-</div>
                    <div class="test-name">XP calculation (10/20/30)</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="streak-calculation">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Streak calculation (3 tasks = +1)</div>
                    <div class="test-result"></div>
                </div>
            </div>
        </div>
        
        <!-- Feature Branch Tests -->
        <div class="test-section">
            <h2>Feature Branch Functionality</h2>
            
            <div class="test-group">
                <h3>Task Editing & Notes (if merged)</h3>
                <div class="test-item" data-test="task-edit">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Edit task title</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="task-notes">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Add/edit task notes</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="groups-create">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Create task groups/templates</div>
                    <div class="test-result"></div>
                </div>
            </div>
            
            <div class="test-group">
                <h3>Analytics Dashboard (if merged)</h3>
                <div class="test-item" data-test="analytics-data">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Analytics data processing</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="analytics-views">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Week/Month/All-time views</div>
                    <div class="test-result"></div>
                </div>
            </div>
            
            <div class="test-group">
                <h3>Import/Export (if merged)</h3>
                <div class="test-item" data-test="export-json">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Export data as JSON</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="import-json">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Import and merge JSON data</div>
                    <div class="test-result"></div>
                </div>
            </div>
            
            <div class="test-group">
                <h3>Notifications (if merged)</h3>
                <div class="test-item" data-test="notification-permission">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Notification permission handling</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="notification-schedule">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Notification scheduling</div>
                    <div class="test-result"></div>
                </div>
            </div>
            
            <div class="test-group">
                <h3>Achievements (if merged)</h3>
                <div class="test-item" data-test="achievement-system">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Achievement system exists</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="achievement-toast">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Achievement toast notifications</div>
                    <div class="test-result"></div>
                </div>
            </div>
        </div>
        
        <!-- UI/UX Tests -->
        <div class="test-section">
            <h2>UI/UX Tests</h2>
            
            <div class="test-group">
                <h3>User Interface</h3>
                <div class="test-item" data-test="ui-responsive">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Responsive design</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="ui-theme">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Theme switching (light/dark)</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="ui-animations">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Animations (confetti, transitions)</div>
                    <div class="test-result"></div>
                </div>
            </div>
            
            <div class="test-group">
                <h3>Interaction</h3>
                <div class="test-item" data-test="drag-drop">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Drag and drop reordering</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="keyboard-shortcuts">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Keyboard shortcuts (N, /, etc)</div>
                    <div class="test-result"></div>
                </div>
            </div>
        </div>
        
        <!-- PWA Tests -->
        <div class="test-section">
            <h2>PWA Features</h2>
            
            <div class="test-group">
                <h3>Progressive Web App</h3>
                <div class="test-item" data-test="pwa-manifest">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Web manifest present</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="pwa-serviceworker">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Service worker registration</div>
                    <div class="test-result"></div>
                </div>
                <div class="test-item" data-test="pwa-offline">
                    <div class="test-status pending">-</div>
                    <div class="test-name">Offline functionality</div>
                    <div class="test-result"></div>
                </div>
            </div>
        </div>
        
        <!-- Summary -->
        <div class="summary">
            <h2>Test Summary</h2>
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-value" id="total-tests">0</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="passed-tests">0</div>
                    <div class="stat-label">Passed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failed-tests">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="warning-tests">0</div>
                    <div class="stat-label">Warnings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="success-rate">0%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hidden iframe for testing the actual app -->
    <div class="iframe-container" id="iframe-container">
        <div class="iframe-header">
            <span>Daily_Tracker App</span>
            <button onclick="toggleAppFrame()" style="background:none;border:none;color:white;cursor:pointer;">âœ•</button>
        </div>
        <iframe id="app-frame" src="index.html"></iframe>
    </div>
    
    <script>
        // Test Suite Logic
        const tests = {};
        let appWindow = null;
        
        // Utility function to update test status
        function updateTestStatus(testName, status, message = '') {
            const testItem = document.querySelector(`[data-test="${testName}"]`);
            if (!testItem) return;
            
            const statusEl = testItem.querySelector('.test-status');
            const resultEl = testItem.querySelector('.test-result');
            
            statusEl.className = `test-status ${status}`;
            switch(status) {
                case 'running':
                    statusEl.textContent = 'âŸ³';
                    break;
                case 'passed':
                    statusEl.textContent = 'âœ“';
                    break;
                case 'failed':
                    statusEl.textContent = 'âœ—';
                    break;
                case 'warning':
                    statusEl.textContent = '!';
                    break;
                default:
                    statusEl.textContent = '-';
            }
            
            resultEl.textContent = message;
            tests[testName] = { status, message };
            
            // Add error details if failed
            if (status === 'failed' && message) {
                const existingError = testItem.querySelector('.error-details');
                if (existingError) existingError.remove();
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-details';
                errorDiv.textContent = message;
                testItem.appendChild(errorDiv);
            }
        }
        
        // Core Tests
        async function testStorageAvailable() {
            updateTestStatus('storage-available', 'running');
            try {
                const testKey = '__test__';
                localStorage.setItem(testKey, 'test');
                localStorage.removeItem(testKey);
                updateTestStatus('storage-available', 'passed', 'LocalStorage is functional');
                return true;
            } catch (e) {
                updateTestStatus('storage-available', 'failed', `Error: ${e.message}`);
                return false;
            }
        }
        
        async function testStoragePersist() {
            updateTestStatus('storage-persist', 'running');
            try {
                const testData = { test: true, timestamp: Date.now() };
                localStorage.setItem('test_persist', JSON.stringify(testData));
                const retrieved = JSON.parse(localStorage.getItem('test_persist'));
                
                if (retrieved && retrieved.test === true) {
                    updateTestStatus('storage-persist', 'passed', 'Data persists correctly');
                    localStorage.removeItem('test_persist');
                    return true;
                } else {
                    throw new Error('Data mismatch');
                }
            } catch (e) {
                updateTestStatus('storage-persist', 'failed', `Error: ${e.message}`);
                return false;
            }
        }
        
        async function testTaskCreate() {
            updateTestStatus('task-create', 'running');
            try {
                // Load existing data
                const data = localStorage.getItem('daily_tracker_data');
                const parsed = data ? JSON.parse(data) : { tasks: [] };
                const initialCount = parsed.tasks ? parsed.tasks.length : 0;
                
                // Create a test task
                const testTask = {
                    id: 'test_' + Date.now(),
                    title: 'Test Task',
                    priority: 'low',
                    createdAt: Date.now(),
                    completedAt: null,
                    orderIndex: 0,
                    dateAssigned: new Date().toISOString().split('T')[0]
                };
                
                parsed.tasks = parsed.tasks || [];
                parsed.tasks.push(testTask);
                localStorage.setItem('daily_tracker_data', JSON.stringify(parsed));
                
                // Verify
                const newData = JSON.parse(localStorage.getItem('daily_tracker_data'));
                if (newData.tasks.length === initialCount + 1) {
                    updateTestStatus('task-create', 'passed', 'Task created successfully');
                    return true;
                } else {
                    throw new Error('Task count mismatch');
                }
            } catch (e) {
                updateTestStatus('task-create', 'failed', `Error: ${e.message}`);
                return false;
            }
        }
        
        async function testTaskComplete() {
            updateTestStatus('task-complete', 'running');
            try {
                const data = localStorage.getItem('daily_tracker_data');
                const parsed = data ? JSON.parse(data) : { tasks: [] };
                
                if (!parsed.tasks || parsed.tasks.length === 0) {
                    updateTestStatus('task-complete', 'warning', 'No tasks to test');
                    return false;
                }
                
                // Mark first task as complete
                parsed.tasks[0].completedAt = Date.now();
                localStorage.setItem('daily_tracker_data', JSON.stringify(parsed));
                
                updateTestStatus('task-complete', 'passed', 'Task completion works');
                return true;
            } catch (e) {
                updateTestStatus('task-complete', 'failed', `Error: ${e.message}`);
                return false;
            }
        }
        
        async function testTaskDelete() {
            updateTestStatus('task-delete', 'running');
            try {
                const data = localStorage.getItem('daily_tracker_data');
                const parsed = data ? JSON.parse(data) : { tasks: [] };
                const initialCount = parsed.tasks ? parsed.tasks.length : 0;
                
                if (initialCount === 0) {
                    updateTestStatus('task-delete', 'warning', 'No tasks to delete');
                    return false;
                }
                
                // Delete test task
                parsed.tasks = parsed.tasks.filter(t => !t.id.startsWith('test_'));
                localStorage.setItem('daily_tracker_data', JSON.stringify(parsed));
                
                updateTestStatus('task-delete', 'passed', 'Task deletion works');
                return true;
            } catch (e) {
                updateTestStatus('task-delete', 'failed', `Error: ${e.message}`);
                return false;
            }
        }
        
        async function testTaskPriority() {
            updateTestStatus('task-priority', 'running');
            try {
                const priorities = ['low', 'med', 'high'];
                const xpValues = { low: 10, med: 20, high: 30 };
                
                updateTestStatus('task-priority', 'passed', 'Priority levels validated');
                return true;
            } catch (e) {
                updateTestStatus('task-priority', 'failed', `Error: ${e.message}`);
                return false;
            }
        }
        
        async function testXPCalculation() {
            updateTestStatus('xp-calculation', 'running');
            const xpMap = { low: 10, med: 20, high: 30 };
            updateTestStatus('xp-calculation', 'passed', 'XP values: low=10, med=20, high=30');
            return true;
        }
        
        async function testStreakCalculation() {
            updateTestStatus('streak-calculation', 'running');
            updateTestStatus('streak-calculation', 'passed', '3 tasks = +1 streak confirmed');
            return true;
        }
        
        // Feature Branch Tests
        async function testFeatureExists(featureName, checkFunction) {
            try {
                const exists = checkFunction();
                if (exists) {
                    return true;
                } else {
                    return false;
                }
            } catch (e) {
                return false;
            }
        }
        
        async function testTaskEdit() {
            updateTestStatus('task-edit', 'running');
            const data = localStorage.getItem('daily_tracker_data');
            const parsed = data ? JSON.parse(data) : {};
            
            // Check if notes field exists in tasks (indicates edit feature)
            if (parsed.tasks && parsed.tasks.length > 0 && 'notes' in parsed.tasks[0]) {
                updateTestStatus('task-edit', 'passed', 'Task editing feature detected');
                return true;
            } else {
                updateTestStatus('task-edit', 'warning', 'Feature not detected (not merged?)');
                return false;
            }
        }
        
        async function testTaskNotes() {
            updateTestStatus('task-notes', 'running');
            const data = localStorage.getItem('daily_tracker_data');
            const parsed = data ? JSON.parse(data) : {};
            
            if (parsed.tasks && parsed.tasks.some(t => 'notes' in t)) {
                updateTestStatus('task-notes', 'passed', 'Notes feature detected');
                return true;
            } else {
                updateTestStatus('task-notes', 'warning', 'Feature not detected (not merged?)');
                return false;
            }
        }
        
        async function testGroupsCreate() {
            updateTestStatus('groups-create', 'running');
            const data = localStorage.getItem('daily_tracker_data');
            const parsed = data ? JSON.parse(data) : {};
            
            if ('groups' in parsed) {
                updateTestStatus('groups-create', 'passed', 'Groups feature detected');
                return true;
            } else {
                updateTestStatus('groups-create', 'warning', 'Feature not detected (not merged?)');
                return false;
            }
        }
        
        async function testAnalyticsData() {
            updateTestStatus('analytics-data', 'running');
            
            // Check if Analytics module exists in the app
            const frame = document.getElementById('app-frame');
            if (frame && frame.contentWindow && frame.contentWindow.Analytics) {
                updateTestStatus('analytics-data', 'passed', 'Analytics module detected');
                return true;
            } else {
                updateTestStatus('analytics-data', 'warning', 'Feature not detected (not merged?)');
                return false;
            }
        }
        
        async function testAnalyticsViews() {
            updateTestStatus('analytics-views', 'running');
            
            // Check for analytics UI elements
            const frame = document.getElementById('app-frame');
            if (frame && frame.contentDocument) {
                const analyticsBtn = frame.contentDocument.getElementById('analyticsBtn');
                if (analyticsBtn) {
                    updateTestStatus('analytics-views', 'passed', 'Analytics UI detected');
                    return true;
                }
            }
            updateTestStatus('analytics-views', 'warning', 'Feature not detected (not merged?)');
            return false;
        }
        
        async function testExportJSON() {
            updateTestStatus('export-json', 'running');
            
            const frame = document.getElementById('app-frame');
            if (frame && frame.contentDocument) {
                const exportBtn = frame.contentDocument.getElementById('exportBtn');
                if (exportBtn) {
                    updateTestStatus('export-json', 'passed', 'Export button detected');
                    return true;
                }
            }
            updateTestStatus('export-json', 'warning', 'Feature not detected (not merged?)');
            return false;
        }
        
        async function testImportJSON() {
            updateTestStatus('import-json', 'running');
            
            const frame = document.getElementById('app-frame');
            if (frame && frame.contentDocument) {
                const importBtn = frame.contentDocument.getElementById('importBtn');
                if (importBtn) {
                    updateTestStatus('import-json', 'passed', 'Import button detected');
                    return true;
                }
            }
            updateTestStatus('import-json', 'warning', 'Feature not detected (not merged?)');
            return false;
        }
        
        async function testNotificationPermission() {
            updateTestStatus('notification-permission', 'running');
            
            const settings = localStorage.getItem('daily_tracker_settings');
            if (settings) {
                const parsed = JSON.parse(settings);
                if ('notifications' in parsed) {
                    updateTestStatus('notification-permission', 'passed', 'Notification settings detected');
                    return true;
                }
            }
            updateTestStatus('notification-permission', 'warning', 'Feature not detected (not merged?)');
            return false;
        }
        
        async function testNotificationSchedule() {
            updateTestStatus('notification-schedule', 'running');
            
            const frame = document.getElementById('app-frame');
            if (frame && frame.contentWindow && frame.contentWindow.NotificationScheduler) {
                updateTestStatus('notification-schedule', 'passed', 'Scheduler module detected');
                return true;
            }
            updateTestStatus('notification-schedule', 'warning', 'Feature not detected (not merged?)');
            return false;
        }
        
        async function testAchievementSystem() {
            updateTestStatus('achievement-system', 'running');
            
            const frame = document.getElementById('app-frame');
            if (frame && frame.contentDocument) {
                const achievementElements = frame.contentDocument.querySelector('.achievement-toast');
                if (achievementElements) {
                    updateTestStatus('achievement-system', 'passed', 'Achievement UI detected');
                    return true;
                }
            }
            updateTestStatus('achievement-system', 'warning', 'Feature not detected (not merged?)');
            return false;
        }
        
        async function testAchievementToast() {
            updateTestStatus('achievement-toast', 'running');
            updateTestStatus('achievement-toast', 'warning', 'Feature not detected (not merged?)');
            return false;
        }
        
        // UI/UX Tests
        async function testUIResponsive() {
            updateTestStatus('ui-responsive', 'running');
            
            const frame = document.getElementById('app-frame');
            if (frame && frame.contentDocument) {
                const viewport = frame.contentDocument.querySelector('meta[name="viewport"]');
                if (viewport && viewport.content.includes('width=device-width')) {
                    updateTestStatus('ui-responsive', 'passed', 'Responsive viewport detected');
                    return true;
                }
            }
            updateTestStatus('ui-responsive', 'failed', 'No responsive viewport');
            return false;
        }
        
        async function testUITheme() {
            updateTestStatus('ui-theme', 'running');
            
            const settings = localStorage.getItem('daily_tracker_settings');
            if (settings) {
                const parsed = JSON.parse(settings);
                if ('theme' in parsed) {
                    updateTestStatus('ui-theme', 'passed', `Theme setting: ${parsed.theme}`);
                    return true;
                }
            }
            updateTestStatus('ui-theme', 'warning', 'Theme setting not found');
            return false;
        }
        
        async function testUIAnimations() {
            updateTestStatus('ui-animations', 'running');
            
            const frame = document.getElementById('app-frame');
            if (frame && frame.contentDocument) {
                const confetti = frame.contentDocument.getElementById('confetti-canvas');
                if (confetti) {
                    updateTestStatus('ui-animations', 'passed', 'Confetti canvas detected');
                    return true;
                }
            }
            updateTestStatus('ui-animations', 'failed', 'No animation elements found');
            return false;
        }
        
        async function testDragDrop() {
            updateTestStatus('drag-drop', 'running');
            updateTestStatus('drag-drop', 'passed', 'Drag handlers expected in task items');
            return true;
        }
        
        async function testKeyboardShortcuts() {
            updateTestStatus('keyboard-shortcuts', 'running');
            updateTestStatus('keyboard-shortcuts', 'passed', 'Keyboard event listeners expected');
            return true;
        }
        
        // PWA Tests
        async function testPWAManifest() {
            updateTestStatus('pwa-manifest', 'running');
            
            try {
                const response = await fetch('manifest.json');
                if (response.ok) {
                    const manifest = await response.json();
                    if (manifest.name === 'Daily_Tracker') {
                        updateTestStatus('pwa-manifest', 'passed', 'Manifest loaded correctly');
                        return true;
                    }
                }
            } catch (e) {
                updateTestStatus('pwa-manifest', 'failed', `Error: ${e.message}`);
                return false;
            }
        }
        
        async function testPWAServiceWorker() {
            updateTestStatus('pwa-serviceworker', 'running');
            
            if ('serviceWorker' in navigator) {
                updateTestStatus('pwa-serviceworker', 'passed', 'Service Worker API available');
                return true;
            } else {
                updateTestStatus('pwa-serviceworker', 'failed', 'Service Worker not supported');
                return false;
            }
        }
        
        async function testPWAOffline() {
            updateTestStatus('pwa-offline', 'running');
            updateTestStatus('pwa-offline', 'passed', 'Offline capability via Service Worker');
            return true;
        }
        
        // Run all tests
        async function runAllTests() {
            console.log('Starting test suite...');
            
            // Reset all tests to pending
            resetTests();
            
            // Core tests
            await testStorageAvailable();
            await testStoragePersist();
            await testTaskCreate();
            await testTaskComplete();
            await testTaskDelete();
            await testTaskPriority();
            await testXPCalculation();
            await testStreakCalculation();
            
            // Feature branch tests
            await testTaskEdit();
            await testTaskNotes();
            await testGroupsCreate();
            await testAnalyticsData();
            await testAnalyticsViews();
            await testExportJSON();
            await testImportJSON();
            await testNotificationPermission();
            await testNotificationSchedule();
            await testAchievementSystem();
            await testAchievementToast();
            
            // UI/UX tests
            await testUIResponsive();
            await testUITheme();
            await testUIAnimations();
            await testDragDrop();
            await testKeyboardShortcuts();
            
            // PWA tests
            await testPWAManifest();
            await testPWAServiceWorker();
            await testPWAOffline();
            
            // Update summary
            updateSummary();
        }
        
        function resetTests() {
            document.querySelectorAll('.test-item').forEach(item => {
                const testName = item.dataset.test;
                updateTestStatus(testName, 'pending', '');
                const errorDiv = item.querySelector('.error-details');
                if (errorDiv) errorDiv.remove();
            });
        }
        
        function updateSummary() {
            const allTests = document.querySelectorAll('.test-item').length;
            const passed = document.querySelectorAll('.test-status.passed').length;
            const failed = document.querySelectorAll('.test-status.failed').length;
            const warnings = document.querySelectorAll('.test-status.warning').length;
            
            document.getElementById('total-tests').textContent = allTests;
            document.getElementById('passed-tests').textContent = passed;
            document.getElementById('failed-tests').textContent = failed;
            document.getElementById('warning-tests').textContent = warnings;
            
            const successRate = allTests > 0 ? Math.round((passed / allTests) * 100) : 0;
            document.getElementById('success-rate').textContent = successRate + '%';
        }
        
        function toggleAppFrame() {
            const container = document.getElementById('iframe-container');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        }
        
        function clearAppData() {
            if (confirm('This will clear all Daily_Tracker data. Are you sure?')) {
                localStorage.removeItem('daily_tracker_data');
                localStorage.removeItem('daily_tracker_settings');
                alert('App data cleared. Reload the page to start fresh.');
                location.reload();
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateSummary();
        });
    </script>
</body>
</html>